#!/usr/bin/env node

const { npm_package_version } = process.env;

if ( npm_package_version === undefined ) {
  console.log('npm_package_version is not defined in the environment. This script should be called from an npm script.');

  process.exit(1);
}

const fs = require('fs');
const path = require('path');

const rootDir = path.resolve( __dirname, '../' );
const manifestPath = path.join( rootDir, 'src', 'manifest.json' );

function getJson( file, overrides )
{
  const contents = fs.readFileSync( file, { encoding: 'utf8' });
  const data = JSON.parse( contents );

  return Object.assign( data, overrides );
}

const manifestData = getJson( manifestPath, { version: npm_package_version } );

const manifestString = JSON.stringify( manifestData, null, 2 );

fs.writeFileSync( manifestPath, `${manifestString}\n` );
